# Postavleno_Bot

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –Ω–∞ Wildberries. –û–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª –∏ ¬´–í—ã–π—Ç–∏¬ª. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –±–æ—Ç–∞, –∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—É—Ä–æ–≤–Ω–µ.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ª—é–±–æ–π –∏–∑ —Ç–æ–∫–µ–Ω–æ–≤ `TELEGRAM_BOT_TOKEN`/`BOT_TOKEN`/`TG_BOT_TOKEN`, –¥–æ–±–∞–≤—å—Ç–µ `WB_API_TOKEN` –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ú–æ–π–°–∫–ª–∞–¥ (`MOYSKLAD_TOKEN` –¥–ª—è Bearer-—Ä–µ–∂–∏–º–∞ –∏–ª–∏ `MOYSKLAD_LOGIN`/`MOYSKLAD_PASSWORD` –¥–ª—è Basic). –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `MOYSKLAD_AUTH_MODE`, `LOG_LEVEL`/`LOG_RICH`/`LOG_JSON` –∏ —É–∫–∞–∂–∏—Ç–µ `LOCAL_STORE_NAME` ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –∫–æ–ª–æ–Ω–∫–µ ¬´–°–∫–ª–∞–¥¬ª –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
   pip install -r requirements-dev.txt  # –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
   pip install -e .                     # –ø–æ–¥–∫–ª—é—á–∞–µ–º –ø–∞–∫–µ—Ç –∏–∑ src/
   ```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   python -m postavleno_bot.main
   ```

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Windows, PowerShell)
```powershell
# 1) –û–¥–∏–Ω —Ä–∞–∑
tools\win\bootstrap.ps1

# 2) –ö–∞–∂–¥—ã–π —Ä–∞–∑ –≤ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
.\.venv\Scripts\Activate.ps1

# 3) –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python -m postavleno_bot.main   # –∏–ª–∏: python -m postavleno_bot

# 4) –ü—Ä–æ–≤–µ—Ä–∫–∏
tools\win\tasks.ps1 all
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline-–∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏

–ë–æ—Ç –∂–∏–≤—ë—Ç –≤ —Ä–µ–∂–∏–º–µ ¬´–æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª. –ü–æ—Å–ª–µ `/start` –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏ ¬´üîÑ –û–±–Ω–æ–≤–∏—Ç—å¬ª –∏ ¬´üö™ –í—ã–π—Ç–∏¬ª. –õ—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ –∏ —Ä–µ–ø–ª–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç —Å—Ç–∞—Ä–∞–µ—Ç—Å—è —É–¥–∞–ª—è—Ç—å, —á—Ç–æ–±—ã –≤ —á–∞—Ç–µ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞.

–ö–Ω–æ–ø–∫–∞ ¬´üîÑ –û–±–Ω–æ–≤–∏—Ç—å¬ª –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏ –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –º–µ—Å—Ç–µ, –∞ ¬´üö™ –í—ã–π—Ç–∏¬ª —É–¥–∞–ª—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –∏ –æ—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤. –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `aiogram 3.x` –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –≤ –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —á–µ—Ä–µ–∑ `Rich`, –∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ `logs/app.json` —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON-–∑–∞–ø–∏—Å–∏ —Å `request_id`, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç–∫–∏.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### üè¨ –û—Å—Ç–∞—Ç–∫–∏ –°–∫–ª–∞–¥ (–ú–æ–π–°–∫–ª–∞–¥)

–ö–Ω–æ–ø–∫–∞ ¬´üìä –£–∑–Ω–∞—Ç—å –û—Å—Ç–∞—Ç–∫–∏¬ª —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–µ—Ä–≤–µ—Ä-—Å–µ—Ä–≤–µ—Ä: –±–æ—Ç —Å–∞–º –ø–æ–ª—É—á–∞–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ –∏–∑ Wildberries –∏ –ú–æ–π–°–∫–ª–∞–¥, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Excel. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã.

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

| –ò–º—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| --- | --- | --- |
| `MOYSKLAD_AUTH_MODE` | –¢–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ API –ú–æ–π–°–∫–ª–∞–¥: `token` (Bearer) –∏–ª–∏ `basic` | `token` |
| `MOYSKLAD_TOKEN` | API-—Ç–æ–∫–µ–Ω –ú–æ–π–°–∫–ª–∞–¥ –¥–ª—è Bearer-—Ä–µ–∂–∏–º–∞ | ‚Äî |
| `MOYSKLAD_LOGIN` / `MOYSKLAD_PASSWORD` | –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è Basic-—Ä–µ–∂–∏–º–∞ | ‚Äî |
| `MOYSKLAD_PAGE_SIZE` | –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –æ–±—Ö–æ–¥–µ `/report/stock/all` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ fallback) | `1000` |
| `MOYSKLAD_QUANTITY_FIELD` | –ö–∞–∫–æ–µ –ø–æ–ª–µ –ú–æ–π–°–∫–ª–∞–¥ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å: `quantity` –∏–ª–∏ `stock` | `quantity` |
| `LOCAL_STORE_NAME` | –ó–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ ¬´–°–∫–ª–∞–¥¬ª –≤ –∏—Ç–æ–≥–æ–≤–æ–º —Ñ–∞–π–ª–µ | `FootballShop` |

–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ú–æ–π–°–∫–ª–∞–¥ (¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª ‚Üí ¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏¬ª ‚Üí ¬´API-—Ç–æ–∫–µ–Ω—ã¬ª). –ü—Ä–∏ basic-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—á—ë—Ç–Ω—É—é –∑–∞–ø–∏—Å—å —Å–æ –≤–∫–ª—é—á—ë–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ API. –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `MOYSKLAD_TOKEN` –∏–ª–∏ `MOYSKLAD_LOGIN`+`MOYSKLAD_PASSWORD` –≤ `.env`.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏**

1. –ë–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `GET https://statistics-api.wildberries.ru/api/v1/supplier/stocks` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Authorization: <WB_TOKEN>` –∏ —Å—Ç—Ä–æ–∏—Ç DataFrame —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ WB.
2. –ê—Ä—Ç–∏–∫—É–ª—ã –∏–∑ –≤—ã–≥—Ä—É–∑–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –≤ –ú–æ–π–°–∫–ª–∞–¥ —Ç–æ—á–µ—á–Ω–æ: –±–æ—Ç –¥–µ–ª–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/entity/assortment?filter=article=‚Ä¶` (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ WB-–∞—Ä—Ç–∏–∫—É–ª–∞, —Å backoff –ø—Ä–∏ 429/5xx). –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –æ–±—Ö–æ–¥ `/report/stock/all` –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª–∞. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–µ `MOYSKLAD_QUANTITY_FIELD`, —á—Ç–æ–±—ã —Å–∫–ª–µ–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ –∫–ª–æ–Ω—ã.
3. DataFrame Wildberries –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: –∫–æ–ª–æ–Ω–∫–∞ —Å–∫–ª–∞–¥–∞ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º `LOCAL_STORE_NAME` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `FootballShop`), –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–≤–ø–∞–≤—à–∏—Ö –∞—Ä—Ç–∏–∫—É–ª–∞. –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π; –µ—Å–ª–∏ –∞—Ä—Ç–∏–∫—É–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—Å—Ç–∞—ë—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ WB.
4. –ì–æ—Ç–æ–≤—ã–π Excel —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `var/exports/ostatki_store_YYYYMMDD_HHMM.xlsx` (–¥–≤–∏–∂–æ–∫ `openpyxl`, –ª–∏—Å—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `LOCAL_STORE_NAME`) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç. –§–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è.

–ù–∞ –∫–Ω–æ–ø–∫–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å: –ø–æ–∫–∞ –∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å, –≤–º–µ—Å—Ç–æ ¬´üìä –£–∑–Ω–∞—Ç—å –û—Å—Ç–∞—Ç–∫–∏¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ¬´‚åõ –ü–æ–ª—É—á–∞—é‚Ä¶¬ª. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.

### –ö—ç—à –æ—Å—Ç–∞—Ç–∫–æ–≤ WB

–û—Å—Ç–∞—Ç–∫–∏ Wildberries –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –Ω–∞ ~3 –º–∏–Ω—É—Ç—ã (–∫–ª—é—á: `('stocks', dateFrom, token_hash)`). –ü—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ –∫—ç—à –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è `wb_cache_hit=true`, –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ‚Äî `wb_cache_hit=false`. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —ç–∫—Ä–∞–Ω –æ—Å—Ç–∞—Ç–∫–æ–≤ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è.

**–°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

* Wildberries Reports API ‚Äî <https://dev.wildberries.ru/en/openapi/reports>
* –ú–æ–π–°–∫–ª–∞–¥ Remap 1.2 ‚Äî <https://dev.moysklad.ru/doc/api/remap/1.2/>

## –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

* –õ–∏–Ω—Ç–µ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã: `ruff`, `black`, `mypy`.
* –¢–µ—Å—Ç—ã: `pytest`.

–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ —Ç–∞–∫:
```bash
ruff --fix src tests
black src tests
mypy src
pytest
```
